name: transcendence
services:
  reverse-proxy:
    build:
      context: ..
      dockerfile: infrastructure/reverse-proxy/Dockerfile
    ports:
      - "8080:80"
      - "8443:443"
    networks:
      - microservices-network
    volumes:
      - ../frontend/certs:/etc/nginx/certs:ro
      - ../infrastructure/reverse-proxy/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - gateway
    restart: "no"

  gateway:
    build: ../services/gateway
    ports:
      - "3000"
    networks:
      - microservices-network
    depends_on:
      # - authentication
      - game-orchestration
      - game-engine
    restart: "no"

  authentication:
    build: ../services/authentication
    ports:
      - "3001"
    networks:
      - microservices-network
    restart: unless-stopped

  # Temporarily disabled for testing
  # hashicorp-vault:
  #   build: ../infrastructure/hashicorp-vault
  #   ports:
  #     - "8200"
  #   networks:
  #     - vault-network
  #   volumes:
  #     - vault-data:/vault/data
  #   environment:
  #     - VAULT_ADDR=http://0.0.0.0:8200
  #   restart: unless-stopped

  game-orchestration:
    build: ../services/game-orchestration
    ports:
      - "3002"
    networks:
      - microservices-network
    environment:
      - GAME_ENGINE_HOST=game-engine
      - GAME_ENGINE_PORT=3003
    restart: unless-stopped

  game-engine:
    build: ../services/game-engine
    ports:
      - "3003"
    networks:
      - microservices-network
    restart: "no"

networks:
  microservices-network:
    driver: bridge

  # Temporarily disabled for testing
  # vault-network:
  #   driver: bridge
  #   internal: false

  # monitoring-network:
  #   driver: bridge
  #   internal: true

  # logging-network:
  #   driver: bridge
  #   internal: true

# Temporarily disabled for testing
# volumes:
#   vault-data:
#   prometheus-data:
#   grafana-data:
#   elasticsearch-data:
